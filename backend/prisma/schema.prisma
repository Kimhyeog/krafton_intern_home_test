generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  email         String         @unique
  username      String         @unique
  password      String
  createdAt     DateTime       @default(now()) @map("created_at")
  assets        Asset[]
  refreshTokens RefreshToken[]
  @@map("users")
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id])
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  @@map("refresh_tokens")
}

model Asset {
  id        Int      @id @default(autoincrement())
  jobId     String   @unique @map("job_id")
  filePath  String   @map("file_path")
  prompt    String
  model     String
  assetType String   @map("asset_type")
  createdAt DateTime @default(now()) @map("created_at")
  fileSize  Int?     @map("file_size")
  duration  Float?

  userId    Int?     @map("user_id")
  user      User?    @relation(fields: [userId], references: [id])

  @@map("assets")
}

model Job {
  id           Int      @id @default(autoincrement())
  jobId        String   @unique @map("job_id")
  status       String   @default("queued") @map("status")
  jobType      String   @map("job_type")
  prompt       String
  model        String
  userId       Int      @map("user_id")
  options      String?
  imagePath    String?  @map("image_path")
  mimeType     String?  @map("mime_type")

  assetId      Int?     @map("asset_id")
  resultUrl    String?  @map("result_url")
  errorMessage String?  @map("error_message")

  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("jobs")
}
